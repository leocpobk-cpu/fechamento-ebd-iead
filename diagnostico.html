<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiagnÃ³stico EBD</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e293b;
            color: #e2e8f0;
        }
        .section {
            background: #334155;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .ok { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1e40af;
        }
        #log {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” DiagnÃ³stico do Sistema EBD</h1>
    
    <div class="section">
        <h3>ğŸ“Š Status do Sistema</h3>
        <div id="status"></div>
    </div>
    
    <div class="section">
        <h3>ğŸ§ª Testes DisponÃ­veis</h3>
        <button onclick="testarArquivos()">ğŸ“‚ Verificar Arquivos</button>
        <button onclick="testarFuncoes()">âš™ï¸ Verificar FunÃ§Ãµes</button>
        <button onclick="testarLocalStorage()">ğŸ’¾ Verificar LocalStorage</button>
        <button onclick="testarSwipe()">ğŸ‘† Testar Swipe</button>
        <button onclick="limparCache()">ğŸ—‘ï¸ Limpar Cache</button>
        <button onclick="abrirSite()">ğŸš€ Abrir Site</button>
    </div>
    
    <div class="section">
        <h3>ğŸ“‹ Log de DiagnÃ³stico</h3>
        <div id="log"></div>
    </div>
    
    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(msg, type = 'info') {
            const colors = { ok: '#10b981', error: '#ef4444', warning: '#f59e0b', info: '#3b82f6' };
            const icons = { ok: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
            log.innerHTML += `<div style="color: ${colors[type]}">${icons[type]} ${new Date().toLocaleTimeString()} - ${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }
        
        async function testarArquivos() {
            addLog('Testando carregamento de arquivos...', 'info');
            
            const arquivos = [
                'https://leocpobk-cpu.github.io/fechamento-ebd-iead/index.html',
                'https://leocpobk-cpu.github.io/fechamento-ebd-iead/licoes.js',
                'https://leocpobk-cpu.github.io/fechamento-ebd-iead/auth.js',
                'https://leocpobk-cpu.github.io/fechamento-ebd-iead/manifest.json',
                'https://leocpobk-cpu.github.io/fechamento-ebd-iead/sw.js'
            ];
            
            for (const url of arquivos) {
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    if (response.ok) {
                        addLog(`${url.split('/').pop()} - OK (${response.status})`, 'ok');
                    } else {
                        addLog(`${url.split('/').pop()} - ERRO (${response.status})`, 'error');
                    }
                } catch (e) {
                    addLog(`${url.split('/').pop()} - FALHA: ${e.message}`, 'error');
                }
            }
        }
        
        function testarFuncoes() {
            addLog('Verificando funÃ§Ãµes JavaScript...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'https://leocpobk-cpu.github.io/fechamento-ebd-iead/';
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                try {
                    const win = iframe.contentWindow;
                    const funcoes = ['fazerLogin', 'mudarTela', 'inicializarSwipe', 'listarUsuarios', 'abrirModalUsuario'];
                    
                    funcoes.forEach(fn => {
                        if (typeof win[fn] === 'function') {
                            addLog(`FunÃ§Ã£o ${fn}() - ENCONTRADA`, 'ok');
                        } else {
                            addLog(`FunÃ§Ã£o ${fn}() - NÃƒO ENCONTRADA`, 'error');
                        }
                    });
                } catch (e) {
                    addLog(`Erro ao acessar iframe: ${e.message}`, 'error');
                }
                document.body.removeChild(iframe);
            };
            
            setTimeout(() => {
                if (document.body.contains(iframe)) {
                    addLog('Timeout ao carregar site', 'error');
                    document.body.removeChild(iframe);
                }
            }, 5000);
        }
        
        function testarLocalStorage() {
            addLog('Verificando LocalStorage...', 'info');
            
            try {
                localStorage.setItem('test', 'ok');
                localStorage.removeItem('test');
                addLog('LocalStorage - FUNCIONANDO', 'ok');
                
                const keys = ['usuariosEBD', 'historicoEBD', 'licoesEBD', 'tema'];
                keys.forEach(key => {
                    const value = localStorage.getItem(key);
                    if (value) {
                        addLog(`${key} - EXISTE (${value.length} chars)`, 'ok');
                    } else {
                        addLog(`${key} - NÃƒO EXISTE`, 'warning');
                    }
                });
            } catch (e) {
                addLog(`LocalStorage - ERRO: ${e.message}`, 'error');
            }
        }
        
        function testarSwipe() {
            addLog('Verificando suporte a Touch...', 'info');
            
            if ('ontouchstart' in window) {
                addLog('Touch Events - SUPORTADO', 'ok');
            } else {
                addLog('Touch Events - NÃƒO SUPORTADO (use DevTools mobile)', 'warning');
            }
            
            addLog(`Largura da tela: ${window.innerWidth}px`, 'info');
            addLog(`Altura da tela: ${window.innerHeight}px`, 'info');
            addLog(`User Agent: ${navigator.userAgent.substring(0, 100)}...`, 'info');
        }
        
        function limparCache() {
            addLog('Limpando cache...', 'info');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    registrations.forEach(registration => {
                        registration.unregister();
                        addLog('Service Worker removido', 'ok');
                    });
                });
            }
            
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                        addLog(`Cache ${name} removido`, 'ok');
                    });
                });
            }
            
            localStorage.clear();
            sessionStorage.clear();
            addLog('LocalStorage e SessionStorage limpos', 'ok');
            addLog('âš ï¸ Recarregue o site agora!', 'warning');
        }
        
        function abrirSite() {
            window.open('https://leocpobk-cpu.github.io/fechamento-ebd-iead/', '_blank');
        }
        
        // Status inicial
        window.onload = () => {
            status.innerHTML = `
                <div class="ok">âœ… DiagnÃ³stico carregado</div>
                <div>ğŸ“… Data: ${new Date().toLocaleString('pt-BR')}</div>
                <div>ğŸŒ Navegador: ${navigator.userAgent.split(' ').pop()}</div>
            `;
            addLog('Sistema de diagnÃ³stico iniciado', 'ok');
            addLog('Clique nos botÃµes acima para executar testes', 'info');
        };
    </script>
</body>
</html>
